plugins {
    id "org.javamodularity.moduleplugin" version "1.6.0"
    id 'org.beryx.jlink' version '2.16.4'
    id 'application'
    id 'java'
}

ext {
    appName = 'Squeeze'
    appLauncher = 'squeeze'
    appPackaging = 'squeeze'
    appModuleName = 'squeeze'
    appMainClass = 'squeeze.Kompressor'
}

group 'com.erstrees'
version '0.1-SNAPSHOT'
mainClassName = "${ext.appModuleName}/${ext.appMainClass}"

sourceCompatibility = 1.11

repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    implementation 'info.picocli:picocli:4.1.2'
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

jlink {
    imageZip = project.file("${buildDir}/distributions/${appPackaging}-${OperatingSystem.canonicalName}.zip")
    options = ['--strip-debug', '--compress', '2', '--no-header-files', '--no-man-pages']
    launcher {
        name = 'squeeze'
    }
}

run {
    if (project.hasProperty('args')) {
        args project.args.split(',')
        System.out.println(args)
    }
}

task dist {
    dependsOn clean, jlinkZip
    description "Cleans and jlinkZip [default]"
}

defaultTasks 'dist'